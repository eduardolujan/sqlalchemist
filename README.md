## Quickstart

1. You must first define some env variables. For convenience you can just source `envrc`.
   You can edit the file if you want but for the tests it should be fine to keep the defaults:

``` bash
source envrc
```

2. Start the Postgresql database:

``` bash
docker-compose up -d
```

3. Try connecting to the database:

``` bash
pgcli -U $USER -h $HOST -p $PORT $DB
```

If you defined `$PASS` on `envrc` then you might need to call `pgcli` with `-W` so that it will
prompt you for a password.

4. If you can connect, you are ready to start using SQLAlchemy and Alebmic!

## OK, I can connect, now what?


Whatever you like?!?!

In this repo we have already taken care of the first steps of the alembic tutorial. This means that
we have already run:
- `alembic init migrations` +  we have already defined an SQLAlchemy
- configured `migrations/env.py` to use our application's `Base`.
- defined a sample model at `pg/models/definitions.py`.

So, if you want to jump straight into the fun you can start for example with generating your first
migration with:

``` bash
alembic revision --autogenerate -m "Add person table."
```

You can then inspect the migration code (i.e. python) with

``` bash
cat /migrations/versions*
```

and the resultant SQL code with:

``` bash
alembic upgrade --sql +1
```

Finally, you can apply the migration with:

``` bash
alembic upgrade +1
```

If you now connect to `pgcli`, you can test that the new table exists:
```
pgcli -U $USER -h $HOST -p $PORT $DB
# and then on the pgcli console:
\dt
# and again on the pgcli console:
SELECT * FROM person;
```

As always, before committing the migration, make sure that the downgrade step works as intended:

``` bash
alembic downgrade -1
```

## So, now what?

Whatever you like?

I mainly use this to test various things like e.g. the SQL code that gets generated by my model
definitions etc.

## Reset database

Running the following commands should get rid of the database instance and its data

``` bash
docker-compose rm --stop --force
docker volume rm sqlalchemyplayground_pg-data
```

If you also want to remove the existing migrations, you can do it with:

``` bash
rm -rf migrations/versions/*
```

## Rationale

